<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Pay - Cash App</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      /* --- Global Styles & Variables --- */
      :root {
        --app-bg-color: #00d54b; /* CASH APP GREEN */
        --text-primary: #ffffff;
        --text-secondary: #c8f7d8; /* Lighter green/white */
        --button-bg-darker: #00b840;
        --button-active-darker: #009c36;
        --placeholder-profile-bg: #888b90;
        --overlay-bg: rgba(0, 0, 0, 0.6);
        --border-radius-button: 50px; /* Fully rounded */
        --padding-screen: 18px;
        --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        --footer-height: 65px;
        --header-height: 70px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      html,
      body {
        height: 100%;
        overflow: hidden;
      } /* Prevent body scroll */

      body {
        font-family: var(--font-family);
        background-color: #000; /* Dark fallback */
        color: var(--text-primary);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .app-container {
        max-width: 450px;
        width: 100%;
        height: 100vh;
        max-height: 900px;
        background-color: var(--app-bg-color);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden; /* Prevent container scroll */
      }

      /* --- Payment Screen Header --- */
      .payment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: calc(var(--padding-screen) * 0.8) var(--padding-screen);
        height: var(--header-height);
        position: relative;
        z-index: 100;
        flex-shrink: 0; /* Prevent shrinking */
      }
      .header-icon-btn {
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 24px;
        cursor: pointer;
        padding: 8px;
        line-height: 1;
      }
      .profile-picture {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer;
        background-color: var(--placeholder-profile-bg);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: block;
      }
      #profile-pic-input {
        display: none;
      }
      /* Profile Dropdown */
      .profile-options-menu {
        display: none;
        position: absolute;
        top: calc(var(--header-height) - 10px);
        right: var(--padding-screen);
        background-color: #ffffff;
        color: #000000;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        padding: 8px 0;
        z-index: 1100;
        min-width: 150px;
        border: 1px solid #eee;
      }
      .profile-options-menu.show {
        display: block;
      }
      .profile-options-menu button {
        display: block;
        width: 100%;
        padding: 10px 15px;
        background: none;
        border: none;
        text-align: left;
        font-family: inherit;
        font-size: 14px;
        color: #000000;
        cursor: pointer;
        transition: background-color 0.15s ease;
      }
      .profile-options-menu button:hover {
        background-color: #f5f5f5;
      }

      /* --- **REVISED** Amount Display Area --- */
      .amount-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Center vertically within its space */
        text-align: center;
        flex-shrink: 0; /* Don't shrink */
        flex-grow: 1; /* ** Allow this area to take significant vertical space */
        min-height: 150px; /* Minimum space */
        padding: clamp(20px, 10vh, 80px) var(--padding-screen) 15px; /* **KEY**: Responsive top padding to push down */
      }
      .displayed-amount {
        font-size: clamp(60px, 18vmin, 90px); /* Responsive large font */
        font-weight: 400; /* Lighter weight like screenshot */
        line-height: 1.1;
        margin-bottom: 15px;
        min-height: 1.1em; /* Min height based on font */
        color: var(--text-primary);
      }
      .currency-selector {
        background-color: var(--button-bg-darker);
        color: var(--text-primary);
        border: none;
        border-radius: 18px;
        padding: 8px 18px;
        font-size: clamp(13px, 3vmin, 15px);
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-top: 5px; /* Space above selector */
      }
      .currency-selector:hover {
        background-color: var(--button-active-darker);
      }
      .currency-selector i {
        margin-left: 6px;
        font-size: 0.8em;
      }

      /* --- Keypad --- */
      .keypad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1px; /* Minimal gap */
        padding: 10px var(--padding-screen) 10px; /* Reduced vertical padding */
        flex-shrink: 0; /* Prevent shrinking */
      }
      .keypad button {
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: clamp(26px, 6vmin, 32px); /* Responsive font */
        font-weight: 400;
        padding: clamp(10px, 3vh, 18px) 0; /* Responsive padding */
        cursor: pointer;
        transition: background-color 0.15s ease;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 60px; /* Min height */
      }
      .keypad button:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .keypad button:active {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .keypad button i {
        font-size: clamp(20px, 5vmin, 26px);
      }

      /* --- Action Buttons --- */
      .action-buttons {
        display: flex;
        gap: 15px;
        padding: 10px var(--padding-screen) 20px; /* Padding above and below */
        flex-shrink: 0;
      }
      .action-buttons button {
        flex-grow: 1;
        background-color: var(--button-bg-darker);
        color: var(--text-primary);
        border: none;
        padding: clamp(14px, 2.5vh, 18px) 10px; /* Responsive padding */
        border-radius: var(--border-radius-button);
        font-size: clamp(16px, 3.5vmin, 18px);
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease, opacity 0.2s ease;
      }
      .action-buttons button:hover {
        background-color: var(--button-active-darker);
      }
      .action-buttons button:active {
        background-color: #00802b;
      }
      .action-buttons button:disabled {
        background-color: #008a33;
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* --- Footer Navigation --- */
      .app-footer {
        /* No longer sticky/absolute */
        display: flex;
        justify-content: space-around;
        align-items: center;
        background-color: var(--app-bg-color);
        border-top: 1px solid rgba(255, 255, 255, 0.15);
        height: var(--footer-height);
        padding: 0 var(--padding-screen);
        z-index: 200;
        flex-shrink: 0; /* Prevent shrinking */
      }
      .nav-item {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        color: #a2f5bf;
        transition: color 0.2s ease, transform 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .nav-item.active {
        color: var(--text-primary);
        transform: scale(1.05);
      }
      .nav-item:hover:not(.active) {
        color: #dffcec;
        transform: scale(1.1);
      }
      .nav-item svg {
        width: 26px;
        height: 26px;
        fill: currentColor;
        display: block;
      }

      /* --- QR Scanner Overlay --- */
      .qr-scanner-overlay {
        display: none;
        position: absolute;
        inset: 0;
        background-color: var(--overlay-bg);
        z-index: 2000;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
      }
      .qr-scanner-overlay.show {
        display: flex;
      }
      #qr-video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 2001;
      }
      .qr-scanner-box {
        width: 65vmin;
        height: 65vmin;
        max-width: 280px;
        max-height: 280px;
        min-width: 180px;
        min-height: 180px;
        border: 3px solid rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        position: relative;
        overflow: hidden;
        margin-bottom: 25px;
        z-index: 2002;
        box-shadow: 0 0 0 100vmax rgba(0, 0, 0, 0.5);
      }
      .qr-scan-line {
        position: absolute;
        left: -5%;
        right: -5%;
        height: 3px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 213, 75, 0.8),
          transparent
        );
        box-shadow: 0 0 15px rgba(0, 213, 75, 0.6);
        border-radius: 2px;
        animation: scan 2.5s linear infinite;
        z-index: 2003;
      }
      .qr-scanner-text {
        font-size: clamp(14px, 3vmin, 18px);
        margin-top: 10px;
        z-index: 2002;
        background-color: rgba(0, 0, 0, 0.4);
        padding: 5px 10px;
        border-radius: 5px;
      }
      @keyframes scan {
        0% {
          top: 0;
        }
        50% {
          top: calc(100% - 3px);
        }
        100% {
          top: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <header class="payment-header">
        <button
          class="header-icon-btn"
          id="qr-scanner-btn"
          aria-label="Scan QR Code"
        >
          <i class="fa-solid fa-qrcode"></i>
        </button>
        <img
          alt="Profile"
          class="profile-picture"
          id="profile-pic-display"
          src="asset/myself.svg"
          onerror="this.style.display='none'; this.parentElement.style.backgroundColor='var(--placeholder-profile-bg, #e0e0e0)';"
        />
        <input type="file" id="profile-pic-input" accept="image/*" />
        <div id="profile-options" class="profile-options-menu">
          <button id="change-pic-btn">Change Picture</button>
          <button id="remove-pic-btn">Remove Picture</button>
        </div>
      </header>

      <!-- Amount Area (takes up flexible space) -->
      <main class="amount-area">
        <div class="displayed-amount" id="displayed-amount">$0</div>
        <button class="currency-selector" id="currency-btn">
          USD <i class="fa-solid fa-chevron-down"></i>
        </button>
      </main>

      <!-- Keypad (fixed height elements) -->
      <section class="keypad" id="keypad">
        <button data-value="1">1</button>
        <button data-value="2">2</button>
        <button data-value="3">3</button>
        <button data-value="4">4</button>
        <button data-value="5">5</button>
        <button data-value="6">6</button>
        <button data-value="7">7</button>
        <button data-value="8">8</button>
        <button data-value="9">9</button>
        <button data-value=".">.</button>
        <button data-value="0" class="key-0">0</button>
        <button data-value="<"><i class="fa-solid fa-delete-left"></i></button>
      </section>

      <!-- Action Buttons (fixed height elements) -->
      <section class="action-buttons">
        <button id="request-btn">Request</button>
        <button id="pay-btn" disabled>Pay</button>
      </section>

      <!-- Footer (fixed height element) -->
      <footer class="app-footer">
        <button class="nav-item" aria-label="Home" onclick="navigateTo('home')">
          <svg viewBox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
        </button>
        <button class="nav-item" aria-label="Card" onclick="navigateTo('card')">
          <svg viewBox="0 0 24 24">
            <path
              d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8h16v10zm0-12H4V6h16v2z"
            />
          </svg>
        </button>
        <button
          class="nav-item active"
          aria-label="Payment"
          onclick="navigateTo('payment')"
        >
          <svg viewBox="0 0 24 24">
            <path
              d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.75-2.7 1.75-1.78 0-2.95-.84-3.17-2.1H6.11c.17 2.28 1.95 3.47 4.39 3.82V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"
            />
          </svg>
        </button>
        <button
          class="nav-item"
          aria-label="Search"
          onclick="navigateTo('search')"
        >
          <svg viewBox="0 0 24 24">
            <path
              d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
            />
          </svg>
        </button>
        <button
          class="nav-item"
          aria-label="Activity"
          onclick="navigateTo('activity')"
        >
          <svg viewBox="0 0 24 24">
            <path
              d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
            />
          </svg>
        </button>
      </footer>

      <!-- QR Scanner Overlay -->
      <div class="qr-scanner-overlay" id="qr-scanner-overlay">
        <video id="qr-video" autoplay playsinline muted></video>
        <div class="qr-scanner-box"><div class="qr-scan-line"></div></div>
        <p class="qr-scanner-text">Scanning...</p>
      </div>
    </div>
    <!-- End app-container -->

    <script>
      // --- DOM Elements ---
      const displayedAmountEl = document.getElementById("displayed-amount");
      const keypadEl = document.getElementById("keypad");
      const requestBtn = document.getElementById("request-btn");
      const payBtn = document.getElementById("pay-btn");
      const currencyBtn = document.getElementById("currency-btn");
      const qrScannerBtn = document.getElementById("qr-scanner-btn");
      const qrScannerOverlay = document.getElementById("qr-scanner-overlay");
      const qrVideoEl = document.getElementById("qr-video");
      // Profile elements
      const profilePicDisplay = document.getElementById("profile-pic-display");
      const profilePicInput = document.getElementById("profile-pic-input");
      const profileOptions = document.getElementById("profile-options");
      const changePicBtn = document.getElementById("change-pic-btn");
      const removePicBtn = document.getElementById("remove-pic-btn");
      const navItems = document.querySelectorAll(".app-footer .nav-item");

      // --- State & Constants ---
      let currentInput = "0"; // Start with 0
      let currentStream = null; // Camera stream
      const maxInputLength = 10;
      const localStorageProfilePicKey = "cashAppProfilePic";
      const placeholderProfilePicSrc = "asset/myself.svg"; // Using file path constant
      const localStoragePaymentAmountKey = "paymentAmount"; // For passing to next page

      // --- Functions ---

      function formatCurrency(amount) {
        // Use standard currency format for alerts etc.
        const number = Number(amount);
        if (isNaN(number)) {
          return "$?.??";
        }
        return `$${number.toLocaleString("en-US", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        })}`;
      }

      function formatAndDisplayAmount() {
        // Displays raw input with '$'
        if (currentInput === "" || currentInput === "0") {
          displayedAmountEl.textContent = "$0";
        } else if (currentInput === ".") {
          displayedAmountEl.textContent = "$0.";
        } else {
          let displayValue = currentInput;
          if (
            displayValue.startsWith("0") &&
            !displayValue.startsWith("0.") &&
            displayValue.length > 1
          ) {
            displayValue = displayValue.substring(1);
            currentInput = displayValue; // Update state too
          }
          displayedAmountEl.textContent = `$${displayValue}`;
        }
        updatePayButtonState();
      }

      function updatePayButtonState() {
        const numericValue = parseFloat(currentInput); // Parse ignores trailing '.'
        payBtn.disabled = isNaN(numericValue) || numericValue <= 0;
      }

      function handleKeyPress(value) {
        if (value === "<") {
          currentInput = currentInput.slice(0, -1);
          if (currentInput === "") currentInput = "0"; // Back to 0 if empty
        } else if (value === ".") {
          if (!currentInput.includes(".")) {
            currentInput = (currentInput === "" ? "0" : currentInput) + ".";
          }
        } else {
          // Digit
          if (currentInput === "0") {
            currentInput = value;
          } else {
            const parts = currentInput.split(".");
            if (parts.length === 1 && parts[0].length >= maxInputLength) return;
            if (parts.length === 2 && parts[1].length >= 2) return;
            currentInput += value;
          }
        }
        formatAndDisplayAmount();
      }

      function handlePay() {
        // Navigate to contact page
        const numericValue = parseFloat(currentInput);
        if (!payBtn.disabled && !isNaN(numericValue) && numericValue > 0) {
          localStorage.setItem(
            localStoragePaymentAmountKey,
            numericValue.toString()
          ); // Save amount for next page
          console.log(
            `Amount ${numericValue} saved. Navigating to contact page.`
          );
          window.location.href = "contact_pay.html"; // **Navigate to contact selection**
        } else {
          console.log("Pay button clicked but amount invalid.");
        }
      }

      function handleRequest() {
        /* ... same placeholder ... */
        const numericValue = parseFloat(currentInput);
        const requestAmount =
          !isNaN(numericValue) && numericValue > 0
            ? formatCurrency(numericValue)
            : "an amount";
        alert(
          `Proceeding to request ${requestAmount}.\n(Next Step: Select Contact - Not Implemented)`
        );
      }

      // --- QR Code Functions ---
      function stopCameraStream() {
        if (currentStream) {
          currentStream.getTracks().forEach((track) => track.stop());
          console.log("Camera stream stopped.");
          currentStream = null;
          qrVideoEl.srcObject = null;
        }
      }
      async function startQrScan() {
        /* ... same camera logic ... */
        qrScannerOverlay.classList.add("show");
        console.log("Attempting QR Scan...");
        stopCameraStream();
        try {
          currentStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
          });
          qrVideoEl.srcObject = currentStream;
          console.log("Camera started.");
          setTimeout(() => {
            if (qrScannerOverlay.classList.contains("show")) {
              stopCameraStream();
              qrScannerOverlay.classList.remove("show");
              console.log("QR Scan Finished (Timeout).");
              alert(
                "QR Code Scanned!\n(Next Step: Show Details - Not Implemented)"
              );
            }
          }, 7000);
        } catch (err) {
          console.error("Camera Error:", err);
          qrScannerOverlay.classList.remove("show");
          alert("Could not access camera.");
          stopCameraStream();
        }
      }

      // --- Profile Picture Logic (Using File Path Default) ---
      function setPlaceholderProfilePic() {
        if (profilePicDisplay) {
          console.log("Setting placeholder:", placeholderProfilePicSrc);
          profilePicDisplay.style.display = "block";
          profilePicDisplay.removeAttribute("onerror");
          profilePicDisplay.src = placeholderProfilePicSrc;
          profilePicDisplay.style.backgroundColor = "";
          profilePicDisplay.onerror = () => {
            console.error(
              `Failed to load default: ${placeholderProfilePicSrc}`
            );
            profilePicDisplay.style.display = "none";
            if (profilePicDisplay.parentElement) {
              profilePicDisplay.parentElement.style.backgroundColor =
                "var(--placeholder-profile-bg, #e0e0e0)";
            }
            profilePicDisplay.onerror = null;
          };
        } else {
          console.warn("profilePicDisplay not found for placeholder.");
        }
      }
      function loadProfilePic() {
        if (!profilePicDisplay) return;
        const savedProfilePic = localStorage.getItem(localStorageProfilePicKey);
        if (savedProfilePic && savedProfilePic.startsWith("data:image/")) {
          console.log("Loading profile pic from localStorage.");
          profilePicDisplay.removeAttribute("onerror");
          profilePicDisplay.src = savedProfilePic;
          profilePicDisplay.style.display = "block";
          profilePicDisplay.style.backgroundColor = "";
          profilePicDisplay.onerror = () => {
            console.warn("Saved profile image failed. Resetting.");
            localStorage.removeItem(localStorageProfilePicKey);
            setPlaceholderProfilePic();
          };
        } else {
          if (savedProfilePic) {
            console.warn("Invalid profile data found, using default.");
            localStorage.removeItem(localStorageProfilePicKey);
          } else {
            console.log("No saved profile pic, using default.");
          }
          setPlaceholderProfilePic();
        }
      }
      function handleProfilePicClick(event) {
        event.stopPropagation();
        if (profileOptions) profileOptions.classList.toggle("show");
      }
      function handleProfilePicChange(event) {
        if (!profilePicDisplay || !profileOptions || !profilePicInput) return;
        const file = event.target.files[0];
        if (!file || !file.type.startsWith("image/")) {
          alert("Please select image.");
          return;
        }
        const reader = new FileReader();
        reader.onload = function (e) {
          profilePicDisplay.src = e.target.result;
          profilePicDisplay.style.backgroundColor = "";
          profilePicDisplay.onerror = () => {
            console.warn("Uploaded image failed. Resetting.");
            localStorage.removeItem(localStorageProfilePicKey);
            setPlaceholderProfilePic();
          };
          saveState();
        };
        reader.readAsDataURL(file);
        profileOptions.classList.remove("show");
        event.target.value = null;
      }
      // Save state function only saves Data URLs
      function saveState() {
        const currentSrc = profilePicDisplay
          ? profilePicDisplay.getAttribute("src")
          : null;
        if (currentSrc && currentSrc.startsWith("data:image/")) {
          localStorage.setItem(localStorageProfilePicKey, currentSrc);
        } else {
          localStorage.removeItem(localStorageProfilePicKey);
        }
        console.log("Profile pic state processed for saving.");
      }

      // Simple Navigation Placeholder (Using original specified filenames)
      function navigateTo(page) {
        const pageMap = {
          home: "money.html",
          card: "card.html",
          payment: "pay.html",
          search: "search_contacts.html",
          activity: "history.html",
        };
        const targetPage = pageMap[page];
        if (
          targetPage &&
          targetPage !== window.location.pathname.split("/").pop()
        ) {
          window.location.href = targetPage;
        } else if (!targetPage) {
          console.warn(`Nav target for '${page}' not defined.`);
        }
      }

      // --- Event Listeners ---
      keypadEl.addEventListener("click", (event) => {
        const target = event.target.closest("button");
        if (target && target.dataset.value) {
          handleKeyPress(target.dataset.value);
        }
      });
      payBtn.addEventListener("click", handlePay);
      requestBtn.addEventListener("click", handleRequest);
      qrScannerBtn.addEventListener("click", startQrScan);
      currencyBtn.addEventListener("click", () =>
        alert("Currency selection not implemented.")
      );
      // Profile listeners
      if (profilePicDisplay)
        profilePicDisplay.addEventListener("click", handleProfilePicClick);
      if (profilePicInput)
        profilePicInput.addEventListener("change", handleProfilePicChange);
      if (changePicBtn)
        changePicBtn.addEventListener("click", () => {
          if (profilePicInput) profilePicInput.click();
          if (profileOptions) profileOptions.classList.remove("show");
        });
      if (removePicBtn)
        removePicBtn.addEventListener("click", () => {
          setPlaceholderProfilePic();
          saveState();
          console.log("Profile picture removed.");
          if (profileOptions) profileOptions.classList.remove("show");
        });
      // Close dropdown listener
      document.addEventListener("click", (event) => {
        if (
          profileOptions &&
          profileOptions.classList.contains("show") &&
          !profileOptions.contains(event.target) &&
          !profilePicDisplay.contains(event.target)
        ) {
          profileOptions.classList.remove("show");
        }
      });
      // Stop camera on visibility change
      document.addEventListener("visibilitychange", () => {
        if (document.hidden && currentStream) {
          console.log("Page hidden, stopping camera.");
          stopCameraStream();
          qrScannerOverlay.classList.remove("show");
        }
      });

      // --- Initial Load ---
      document.addEventListener("DOMContentLoaded", () => {
        loadProfilePic();
        formatAndDisplayAmount(); // Initialize display to $0
        // Set Active Footer Item for Payment page
        navItems.forEach((item) => {
          item.classList.toggle(
            "active",
            item.getAttribute("aria-label") === "Payment"
          );
        });
        console.log("Payment page initialized.");
      });
    </script>
  </body>
</html>
